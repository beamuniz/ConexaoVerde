@model FornecedorPerfilModel

@{
    ViewData["Title"] = "Perfil do Fornecedor";
    var endereco = Model.Fornecedor.Endereco;
    var enderecoCompleto = $"{endereco.Rua}, {endereco.Numero}, {endereco.Cidade} - {endereco.Estado}, {endereco.CEP}";
}

<style>
    /* Estilo para a área de mensagens com rolagem */
    #chatMessages {
        max-height: 300px;
        overflow-y: auto;
    }

    /* Alterar cores para tons de verde */
    .btn-green {
        background-color: #4CAF50; 
        color: white;
    }

    .btn-green:hover {
        background-color: #388E3C;
    }
</style>

<section class="bg-white py-16">
    <div class="container mx-auto px-6">
        <!-- Seta de Voltar -->
        <div class="mb-8">
            <a href="/Fornecedor/ListarFornecedor" class="inline-flex items-center px-4 py-2 btn-green font-semibold text-lg rounded-lg">
                <i class="fas fa-arrow-left mr-3"></i>
                Voltar
            </a>
        </div>

        <!-- Título -->
        <h1 class="text-4xl font-semibold text-gray-800 text-center mb-12">
            <span class="text-3xl font-bold text-black mb-8 text-center">@Model.Fornecedor.NomeFantasia</span>
        </h1>

        <div class="flex flex-wrap justify-center gap-12">
            <!-- Imagem do Fornecedor -->
            <div class="w-full md:w-2/3 lg:w-1/3 xl:w-1/4 mb-8 flex flex-col items-center">
                <img src="@(Model.Usuario.FotoPerfil != null ? $"data:image/png;base64,{Convert.ToBase64String(Model.Usuario.FotoPerfil)}" : "https://via.placeholder.com/400x400")"
                     alt="Imagem Fornecedor"
                     class="w-56 h-56 rounded-full shadow-xl border-4 border-green-500 mb-6">
            </div>

            <!-- Informações do Fornecedor -->
            <div class="md:w-2/3 md:pl-8">
                <div class="mb-6">
                    <!-- Título com divisor -->
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-building text-green-500 mr-2"></i>
                        Informações do Fornecedor
                    </h2>
                    <div class="mt-2 h-1 bg-green-500 w-96 rounded"></div>

                    <!-- Conteúdo -->
                    <div class="mt-6 bg-gray-50 p-8 rounded-xl shadow-lg">
                        <!-- Razão Social -->
                        <div class="flex items-center mb-4">
                            <i class="fas fa-id-card text-green-500 text-xl mr-3"></i>
                            <h3 class="text-xl font-semibold text-gray-800">@Model.Fornecedor.RazaoSocial</h3>
                        </div>

                        <!-- CNPJ -->
                        <div class="flex items-center mb-4">
                            <i class="fas fa-file-alt text-green-500 text-xl mr-3"></i>
                            <p class="text-lg text-gray-600">
                                <strong>Cnpj:</strong>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                                    @Model.Fornecedor.Cnpj
                                </span>
                            </p>
                        </div>

                        <!-- Descrição -->
                        <div class="flex items-start mt-4">
                            <i class="fas fa-info-circle text-green-500 text-xl mr-3"></i>
                            <p class="text-lg text-gray-700 leading-relaxed">
                                <strong>Sobre:</strong> @Model.Fornecedor.Descricao
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Informações de Contato -->
                <div class="flex flex-col items-center text-center">
                    <h2 class="text-3xl font-bold text-black mb-8">Contatos</h2>
                    <ul class="space-y-4 text-gray-700">
                        <!-- Telefone -->
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-phone-alt text-green-500"></i>
                            <p class="text-lg">
                                <strong>Telefone:</strong> @Model.Usuario.Telefone
                            </p>
                        </li>
                        <!-- E-mail -->
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-envelope text-green-500"></i>
                            <p class="text-lg">
                                <strong>E-mail:</strong> @Model.Usuario.Email
                            </p>
                        </li>
                        <!-- Endereço -->
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-map-marker-alt text-green-500"></i>
                            <p class="text-lg">
                                <strong>Endereço:</strong> @enderecoCompleto
                            </p>
                        </li>
                    </ul>
                </div>

                <!-- Mapa do Endereço -->
                <div class="mt-16">
                    <div class="w-full" style="height: 500px;">
                        <iframe src="https://www.google.com/maps?q=@enderecoCompleto&output=embed" width="100%" height="100%" style="border:0;">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>

        <!-- Galeria de Produtos -->
        <section class="flex flex-col lg:h-screen justify-center items-center">
            <h2 class="text-3xl font-bold text-black mb-8 text-center">
                Produtos de @Model.Fornecedor.NomeFantasia
            </h2>
            <div class="flex flex-wrap justify-center md:justify-start mt-6 gap-8">
                @foreach (var produto in Model.Produtos)
                {
                    <div class="relative flex flex-col items-center w-full md:w-64 bg-white rounded-3xl shadow-lg transition-transform transform hover:scale-105">
                        <img src="data:image/jpeg;base64,@produto.ImgProdutoBase64"
                             alt="@produto.NomeProduto"
                             class="w-full h-64 object-cover rounded-t-3xl">
                        <div class="p-6">
                            <h3 class="text-lg font-semibold text-gray-800">@produto.NomeProduto</h3>
                            <p class="text-sm text-gray-600 mt-2">R$ @produto.Preco.ToString("F2")</p>
                        </div>
                    </div>
                }
            </div>
        </section>

        <!-- Seção de Feedbacks -->
        <section class="bg-white py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-black mb-8 text-center">Feedbacks e Avaliações</h2>

                <!-- Comentários dos usuários -->
                <div class="space-y-6">
                    @foreach (var comentario in Model.Avaliacoes ?? [] )
                    {
                        <div class="flex items-start gap-4 bg-gray-50 p-6 rounded-xl shadow-lg">
                            <!-- Foto de Perfil do Usuário -->
                            <img src="@(comentario.Cliente.FotoPerfil != null ? $"data:image/png;base64,{Convert.ToBase64String(comentario.Cliente.FotoPerfil)}" : "https://via.placeholder.com/100")"
                                 alt="Foto Perfil" class="w-16 h-16 rounded-full border-2 border-green-500">
                            <div class="flex-1">
                                <!-- Nome do Usuário -->
                                <h3 class="font-semibold text-lg text-gray-800">@comentario.Cliente!.Nome</h3>
                                <!-- Estrelas -->
                                <div class="flex items-center text-yellow-500 mt-2">
                                    @for (var i = 0; i < 5; i++)
                                    {
                                        <i class="fas fa-star @(i < comentario.Nota ? "text-yellow-500" : "text-gray-300")"></i>
                                    }
                                </div>
                                <!-- Comentário -->
                                <p class="text-gray-600 mt-4">@comentario.Comentario</p>
                            </div>
                        </div>
                    }
                </div>

                <!-- Avaliação de 5 Estrelas e Comentário -->
                <div class="mt-12 bg-gray-50 p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-6">Deixe sua Avaliação</h3>

                    <form id="feedbackForm" action="@Url.Action("AvaliarFornecedor", "Fornecedor")" method="post" onsubmit="return handleFormSubmit(event)">
                        <div class="flex items-center mb-4">
                            <label for="rating" class="text-lg font-medium text-gray-700 mr-4">Avaliação:</label>
                            <div class="flex items-center space-x-1" id="ratingStars">
                                @for (var i = 1; i <= 5; i++)
                                {
                                    <div class="star cursor-pointer text-2xl text-gray-300" data-value="@i">
                                        <i class="fas fa-star"></i>
                                    </div>
                                }
                            </div>
                        </div>

                        <!-- Campo de Comentário -->
                        <div class="mb-6">
                            <label for="comentario" class="block text-sm font-medium text-gray-700">Comentário</label>
                            <textarea id="comentario" name="Comentario" rows="4"
                                      class="mt-2 p-2 w-full border rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500 text-gray-800"
                                      placeholder="Escreva seu comentário"></textarea>
                        </div>

                        <input type="hidden" name="FornecedorId" value="@Model.Fornecedor.Id"/>
                        <input type="hidden" name="ClienteId" value="@ViewBag.ClienteId"/>

                        <button type="submit" class="btn-green w-full py-3 mt-4 rounded-lg text-lg font-semibold">
                            Enviar Avaliação
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </div>
</section>